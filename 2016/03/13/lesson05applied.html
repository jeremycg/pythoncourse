<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Lesson 05 - pandas part 2</title>
  <meta name="description" content="Lesson 05 - Pandas part 2">

  <link rel="stylesheet" href="/pythoncourse/css/main.css">
  <link rel="canonical" href="http://jeremy.kiwi.nz/pythoncourse/pythoncourse/2016/03/13/lesson05applied.html">
  <link rel="alternate" type="application/rss+xml" title="Python @ Precima" href="http://jeremy.kiwi.nz/pythoncourse/pythoncourse/feed.xml">
</head>


  <body>

    <header class="site-header">

  <div class="wrapper">

    <a class="site-title" href="/pythoncourse/">Python @ Precima</a>

    <nav class="site-nav">
      <a href="#" class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </a>

      <div class="trigger">
        
          
        
          
        
          
        
          
          <a class="page-link" href="/pythoncourse/tag/Applied%20Statistics%20stream/">Applied Statistics stream</a>
          
        
          
          <a class="page-link" href="/pythoncourse/tag/R&D%20stream/">R&D stream</a>
          
        
          
          <a class="page-link" href="/pythoncourse/tag/python/">python</a>
          
        
          
          <a class="page-link" href="/pythoncourse/tag/notebook/">notebook</a>
          
        
      </div>
    </nav>

  </div>

</header>

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-73837623-1', 'auto');
  ga('send', 'pageview');

</script>

    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Lesson 05 - pandas part 2</h1>
    <p class="post-meta"><time datetime="2016-03-13T00:00:00-05:00" itemprop="datePublished">Mar 13, 2016</time> • <span itemprop="author" itemscope itemtype="http://schema.org/Person"><span itemprop="name">Jeremy</span></span></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <h2 id="lesson-05---pandas-part-2">Lesson 05 - Pandas part 2</h2>

<p>Welcome to lesson 6! In this lesson we will introduce pandas as our main way of
storing data. NumPy will be useful when we have a uniform multidimensional data
set, but for now pandas will be our default.</p>

<p>Again, an exhaustive run through of pandas is too much for this class - see the
book - <a href="http://shop.oreilly.com/product/0636920023784.do">Python for Data
Analysis</a> or the <a href="http://pandas.pydata.org/pandas-docs/version/0.17.1/">official
pandas website</a>.</p>

<p>If you are familiar with <a href="http://pandas.pydata.org/pandas-
docs/version/0.17.1/comparison_with_r.html">R</a>,
<a href="http://pandas.pydata.org/pandas-
docs/version/0.17.1/comparison_with_sas.html">SAS</a>, and/or
<a href="http://pandas.pydata.org/pandas-
docs/version/0.17.1/comparison_with_sql.html">SQL</a>, click on the links to lead you to
the intro to pandas for users of each language.</p>

<p>Please download todays notebook
<a href="/pythoncourse/assets/notebooks/applied/lesson 05 applied.ipynb">here</a>.</p>

<h3 id="data-import">Data Import</h3>

<p>Importing data is the most important first step to get our data in. Today we
will cover read_csv, before we finish the course we will talk about how to
connect to your netezza (and other SQL) databases</p>

<p><strong>In [1]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">DataFrame</span><span class="p">,</span> <span class="n">Series</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span></code></pre></figure>

<p>We have a ton of ways of reading data into and writing data out of pandas. See
the <a href="http://pandas.pydata.org/pandas-docs/stable/io.html">dataIO page</a> for more
details.</p>

<p><strong>In [3]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#using a string as example</span>
<span class="c">#we could refer to file names if we had the file saved</span>
<span class="n">data</span> <span class="o">=</span> <span class="s">'''
date,A,B,C
20090101,a,1,2
20090102,b,3,4
20090103,c,4,5
'''</span>
<span class="k">print</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>date,A,B,C
20090101,a,1,2
20090102,b,3,4
20090103,c,4,5
</code></pre>
</div>

<p><strong>In [3]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#by default, the index is arange(nrows)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">))</span></code></pre></figure>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>20090101</td>
      <td>a</td>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>20090102</td>
      <td>b</td>
      <td>3</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2</th>
      <td>20090103</td>
      <td>c</td>
      <td>4</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
</div>

<p><strong>In [4]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#we can specify the index:</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="c">#also index_col='date'</span></code></pre></figure>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>20090101</th>
      <td>a</td>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <th>20090102</th>
      <td>b</td>
      <td>3</td>
      <td>4</td>
    </tr>
    <tr>
      <th>20090103</th>
      <td>c</td>
      <td>4</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
</div>

<p><strong>In [40]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#we can also use nested indices:</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="s">'date'</span><span class="p">,</span><span class="s">'A'</span><span class="p">])</span></code></pre></figure>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th></th>
      <th>B</th>
      <th>C</th>
    </tr>
    <tr>
      <th>date</th>
      <th>A</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>20090101</th>
      <th>a</th>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <th>20090102</th>
      <th>b</th>
      <td>3</td>
      <td>4</td>
    </tr>
    <tr>
      <th>20090103</th>
      <th>c</th>
      <td>4</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
</div>

<p><strong>In [5]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#we can specify data type (it will speed things up, or avoid conversion)</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="s">'date'</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s">'A'</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="s">'B'</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="s">'C'</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">})</span></code></pre></figure>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>20090101</th>
      <td>a</td>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <th>20090102</th>
      <td>b</td>
      <td>3</td>
      <td>4</td>
    </tr>
    <tr>
      <th>20090103</th>
      <td>c</td>
      <td>4</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
</div>

<p><strong>In [6]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#We can throw out names and use our own</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">dtype</span><span class="o">=</span><span class="p">{</span><span class="s">'A'</span> <span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="s">'B'</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="s">'C'</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">},</span>
           <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s">"foo"</span><span class="p">,</span> <span class="s">'bar'</span><span class="p">,</span> <span class="s">"baz"</span><span class="p">],</span>
           <span class="n">header</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span></code></pre></figure>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>foo</th>
      <th>bar</th>
      <th>baz</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>20090101</th>
      <td>a</td>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <th>20090102</th>
      <td>b</td>
      <td>3</td>
      <td>4</td>
    </tr>
    <tr>
      <th>20090103</th>
      <td>c</td>
      <td>4</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
</div>

<p><strong>In [57]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#filter out some unneeded columns:</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
           <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s">'date'</span><span class="p">,</span> <span class="s">'foo'</span><span class="p">,</span> <span class="s">'bar'</span><span class="p">,</span> <span class="s">"baz"</span><span class="p">],</span>
           <span class="n">header</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
           <span class="n">usecols</span> <span class="o">=</span> <span class="p">[</span><span class="s">'foo'</span><span class="p">,</span> <span class="s">'baz'</span><span class="p">])</span></code></pre></figure>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>foo</th>
      <th>baz</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>a</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>b</td>
      <td>4</td>
    </tr>
    <tr>
      <th>2</th>
      <td>c</td>
      <td>5</td>
    </tr>
  </tbody>
</table>
</div>

<p><strong>In [5]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#dates! more to come</span>
<span class="n">dat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span>
           <span class="n">parse_dates</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
            <span class="n">index_col</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
           <span class="p">)</span>
<span class="n">dat</span><span class="o">.</span><span class="n">index</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>DatetimeIndex(['2009-01-01', '2009-01-02', '2009-01-03'], dtype='datetime64[ns]', name='date', freq=None)
</code></pre>
</div>

<h3 id="dataframes">DataFrames</h3>

<p>DataFrames are similar to a dict of a series - technically they are a 2d series
with some linking between levels.</p>

<p>Columns are arrays (must be one data type), and rows are similar to dicts.</p>

<p>However, the row/column mapping is not as strictly enforced as R.</p>

<p><strong>In [7]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">dat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">"http://jeremy.kiwi.nz/pythoncourse/assets/tests/r&amp;d/test1data.csv"</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="mi">20</span><span class="p">]</span>
<span class="n">dat</span></code></pre></figure>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>TripType</th>
      <th>VisitNumber</th>
      <th>Weekday</th>
      <th>Upc</th>
      <th>ScanCount</th>
      <th>DepartmentDescription</th>
      <th>FinelineNumber</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>30</td>
      <td>7</td>
      <td>Friday</td>
      <td>60538815980</td>
      <td>1</td>
      <td>SHOES</td>
      <td>8931</td>
    </tr>
    <tr>
      <th>2</th>
      <td>30</td>
      <td>7</td>
      <td>Friday</td>
      <td>7410811099</td>
      <td>1</td>
      <td>PERSONAL CARE</td>
      <td>4504</td>
    </tr>
    <tr>
      <th>3</th>
      <td>26</td>
      <td>8</td>
      <td>Friday</td>
      <td>2238403510</td>
      <td>2</td>
      <td>PAINT AND ACCESSORIES</td>
      <td>3565</td>
    </tr>
    <tr>
      <th>4</th>
      <td>26</td>
      <td>8</td>
      <td>Friday</td>
      <td>2006613744</td>
      <td>2</td>
      <td>PAINT AND ACCESSORIES</td>
      <td>1017</td>
    </tr>
    <tr>
      <th>5</th>
      <td>26</td>
      <td>8</td>
      <td>Friday</td>
      <td>2006618783</td>
      <td>2</td>
      <td>PAINT AND ACCESSORIES</td>
      <td>1017</td>
    </tr>
    <tr>
      <th>6</th>
      <td>26</td>
      <td>8</td>
      <td>Friday</td>
      <td>2006613743</td>
      <td>1</td>
      <td>PAINT AND ACCESSORIES</td>
      <td>1017</td>
    </tr>
    <tr>
      <th>7</th>
      <td>26</td>
      <td>8</td>
      <td>Friday</td>
      <td>7004802737</td>
      <td>1</td>
      <td>PAINT AND ACCESSORIES</td>
      <td>2802</td>
    </tr>
    <tr>
      <th>8</th>
      <td>26</td>
      <td>8</td>
      <td>Friday</td>
      <td>2238495318</td>
      <td>1</td>
      <td>PAINT AND ACCESSORIES</td>
      <td>4501</td>
    </tr>
    <tr>
      <th>9</th>
      <td>26</td>
      <td>8</td>
      <td>Friday</td>
      <td>2238400200</td>
      <td>-1</td>
      <td>PAINT AND ACCESSORIES</td>
      <td>3565</td>
    </tr>
    <tr>
      <th>10</th>
      <td>26</td>
      <td>8</td>
      <td>Friday</td>
      <td>5200010239</td>
      <td>1</td>
      <td>DSD GROCERY</td>
      <td>4606</td>
    </tr>
    <tr>
      <th>11</th>
      <td>26</td>
      <td>8</td>
      <td>Friday</td>
      <td>88679300501</td>
      <td>2</td>
      <td>PAINT AND ACCESSORIES</td>
      <td>3504</td>
    </tr>
    <tr>
      <th>12</th>
      <td>26</td>
      <td>8</td>
      <td>Friday</td>
      <td>22006000000</td>
      <td>1</td>
      <td>MEAT - FRESH &amp; FROZEN</td>
      <td>6009</td>
    </tr>
    <tr>
      <th>13</th>
      <td>26</td>
      <td>8</td>
      <td>Friday</td>
      <td>2236760452</td>
      <td>1</td>
      <td>PAINT AND ACCESSORIES</td>
      <td>7</td>
    </tr>
    <tr>
      <th>14</th>
      <td>26</td>
      <td>8</td>
      <td>Friday</td>
      <td>88679300501</td>
      <td>-1</td>
      <td>PAINT AND ACCESSORIES</td>
      <td>3504</td>
    </tr>
    <tr>
      <th>15</th>
      <td>26</td>
      <td>8</td>
      <td>Friday</td>
      <td>2238400200</td>
      <td>2</td>
      <td>PAINT AND ACCESSORIES</td>
      <td>3565</td>
    </tr>
    <tr>
      <th>16</th>
      <td>26</td>
      <td>8</td>
      <td>Friday</td>
      <td>3019294203</td>
      <td>1</td>
      <td>PAINT AND ACCESSORIES</td>
      <td>2801</td>
    </tr>
    <tr>
      <th>17</th>
      <td>26</td>
      <td>8</td>
      <td>Friday</td>
      <td>72450408840</td>
      <td>1</td>
      <td>PAINT AND ACCESSORIES</td>
      <td>1028</td>
    </tr>
    <tr>
      <th>18</th>
      <td>26</td>
      <td>8</td>
      <td>Friday</td>
      <td>25541500000</td>
      <td>2</td>
      <td>DAIRY</td>
      <td>1305</td>
    </tr>
    <tr>
      <th>19</th>
      <td>26</td>
      <td>8</td>
      <td>Friday</td>
      <td>2310010776</td>
      <td>1</td>
      <td>PETS AND SUPPLIES</td>
      <td>3300</td>
    </tr>
  </tbody>
</table>
</div>

<p><strong>In [12]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># get the column names</span>
<span class="n">dat</span><span class="o">.</span><span class="n">columns</span>
<span class="c">#get the first five rows</span>
<span class="n">dat</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
<span class="c">#pick out specific columns</span>
<span class="n">DataFrame</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s">'TripType'</span><span class="p">,</span><span class="s">'VisitNumber'</span><span class="p">])</span>
<span class="c">#same as</span>
<span class="n">dat</span><span class="p">[[</span><span class="s">'TripType'</span><span class="p">,</span><span class="s">'VisitNumber'</span><span class="p">]]</span>
<span class="c">#get one specific column</span>
<span class="n">dat</span><span class="o">.</span><span class="n">TripType</span>
<span class="c">#get one specific column</span>
<span class="n">dat</span><span class="p">[</span><span class="s">'TripType'</span><span class="p">]</span>
<span class="c">#if we want rows, we need ix, loc or iloc</span>
<span class="c">#loc works on labels in the index:</span>
<span class="n">dat</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="c">#iloc works on integer index:</span>
<span class="n">dat</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="c">#ix tries to work like loc, but falls back to iloc if not found:</span>
<span class="n">dat</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="c">#add a new column</span>
<span class="n">dat</span><span class="p">[</span><span class="s">'foo'</span><span class="p">]</span><span class="o">=</span><span class="s">"spam"</span>
<span class="c">#using other columns:</span>
<span class="n">dat</span><span class="p">[</span><span class="s">'foo'</span><span class="p">]</span> <span class="o">=</span> <span class="n">dat</span><span class="p">[</span><span class="s">'VisitNumber'</span><span class="p">]</span> <span class="o">+</span> <span class="n">dat</span><span class="p">[</span><span class="s">'ScanCount'</span><span class="p">]</span>
<span class="c">#add a new column with specific values</span>
<span class="n">dat</span><span class="p">[</span><span class="s">'foo'</span><span class="p">]</span><span class="o">=</span><span class="n">Series</span><span class="p">([</span><span class="s">'spam'</span><span class="p">,</span> <span class="s">'more spam'</span><span class="p">],</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span><span class="mi">10</span><span class="p">])</span></code></pre></figure>

<p><strong>In [13]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#delete a column</span>
<span class="k">del</span> <span class="n">dat</span><span class="p">[</span><span class="s">'foo'</span><span class="p">]</span>
<span class="c">#'http://pandas.pydata.org/pandas-docs/dev/generated/pandas.DataFrame.html'</span></code></pre></figure>

<p><strong>In [15]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#recall, indexes are immutable?</span>
<span class="c">#how to reindex?</span>
<span class="n">dat</span> <span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="n">dat</span></code></pre></figure>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>TripType</th>
      <th>VisitNumber</th>
      <th>Weekday</th>
      <th>Upc</th>
      <th>ScanCount</th>
      <th>DepartmentDescription</th>
      <th>FinelineNumber</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>30</td>
      <td>7</td>
      <td>Friday</td>
      <td>60538815980</td>
      <td>1</td>
      <td>SHOES</td>
      <td>8931</td>
    </tr>
    <tr>
      <th>2</th>
      <td>30</td>
      <td>7</td>
      <td>Friday</td>
      <td>7410811099</td>
      <td>1</td>
      <td>PERSONAL CARE</td>
      <td>4504</td>
    </tr>
    <tr>
      <th>3</th>
      <td>26</td>
      <td>8</td>
      <td>Friday</td>
      <td>2238403510</td>
      <td>2</td>
      <td>PAINT AND ACCESSORIES</td>
      <td>3565</td>
    </tr>
    <tr>
      <th>4</th>
      <td>26</td>
      <td>8</td>
      <td>Friday</td>
      <td>2006613744</td>
      <td>2</td>
      <td>PAINT AND ACCESSORIES</td>
      <td>1017</td>
    </tr>
  </tbody>
</table>
</div>

<p><strong>In [16]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">dat</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span><span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">dat</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span><span class="n">method</span><span class="o">=</span><span class="s">'ffill'</span><span class="p">)</span></code></pre></figure>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>TripType</th>
      <th>VisitNumber</th>
      <th>Weekday</th>
      <th>Upc</th>
      <th>ScanCount</th>
      <th>DepartmentDescription</th>
      <th>FinelineNumber</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>30</td>
      <td>7</td>
      <td>Friday</td>
      <td>60538815980</td>
      <td>1</td>
      <td>SHOES</td>
      <td>8931</td>
    </tr>
    <tr>
      <th>2</th>
      <td>30</td>
      <td>7</td>
      <td>Friday</td>
      <td>7410811099</td>
      <td>1</td>
      <td>PERSONAL CARE</td>
      <td>4504</td>
    </tr>
    <tr>
      <th>3</th>
      <td>26</td>
      <td>8</td>
      <td>Friday</td>
      <td>2238403510</td>
      <td>2</td>
      <td>PAINT AND ACCESSORIES</td>
      <td>3565</td>
    </tr>
    <tr>
      <th>4</th>
      <td>26</td>
      <td>8</td>
      <td>Friday</td>
      <td>2006613744</td>
      <td>2</td>
      <td>PAINT AND ACCESSORIES</td>
      <td>1017</td>
    </tr>
    <tr>
      <th>5</th>
      <td>26</td>
      <td>8</td>
      <td>Friday</td>
      <td>2006613744</td>
      <td>2</td>
      <td>PAINT AND ACCESSORIES</td>
      <td>1017</td>
    </tr>
    <tr>
      <th>6</th>
      <td>26</td>
      <td>8</td>
      <td>Friday</td>
      <td>2006613744</td>
      <td>2</td>
      <td>PAINT AND ACCESSORIES</td>
      <td>1017</td>
    </tr>
    <tr>
      <th>7</th>
      <td>26</td>
      <td>8</td>
      <td>Friday</td>
      <td>2006613744</td>
      <td>2</td>
      <td>PAINT AND ACCESSORIES</td>
      <td>1017</td>
    </tr>
    <tr>
      <th>8</th>
      <td>26</td>
      <td>8</td>
      <td>Friday</td>
      <td>2006613744</td>
      <td>2</td>
      <td>PAINT AND ACCESSORIES</td>
      <td>1017</td>
    </tr>
    <tr>
      <th>9</th>
      <td>26</td>
      <td>8</td>
      <td>Friday</td>
      <td>2006613744</td>
      <td>2</td>
      <td>PAINT AND ACCESSORIES</td>
      <td>1017</td>
    </tr>
  </tbody>
</table>
</div>

<p><strong>In [18]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">dat</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="c">#dat.drop('foo', axis = 1)</span></code></pre></figure>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>TripType</th>
      <th>VisitNumber</th>
      <th>Weekday</th>
      <th>Upc</th>
      <th>ScanCount</th>
      <th>DepartmentDescription</th>
      <th>FinelineNumber</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>30</td>
      <td>7</td>
      <td>Friday</td>
      <td>7410811099</td>
      <td>1</td>
      <td>PERSONAL CARE</td>
      <td>4504</td>
    </tr>
    <tr>
      <th>3</th>
      <td>26</td>
      <td>8</td>
      <td>Friday</td>
      <td>2238403510</td>
      <td>2</td>
      <td>PAINT AND ACCESSORIES</td>
      <td>3565</td>
    </tr>
    <tr>
      <th>4</th>
      <td>26</td>
      <td>8</td>
      <td>Friday</td>
      <td>2006613744</td>
      <td>2</td>
      <td>PAINT AND ACCESSORIES</td>
      <td>1017</td>
    </tr>
  </tbody>
</table>
</div>

<p><strong>In [19]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#getting data</span>
<span class="n">dat</span><span class="p">[[</span><span class="s">'TripType'</span><span class="p">,</span><span class="s">'Upc'</span><span class="p">]]</span>
<span class="n">dat</span><span class="p">[</span><span class="s">'ScanCount'</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">1</span>
<span class="n">dat</span><span class="p">[</span><span class="n">dat</span><span class="p">[</span><span class="s">'ScanCount'</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">]</span></code></pre></figure>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>TripType</th>
      <th>VisitNumber</th>
      <th>Weekday</th>
      <th>Upc</th>
      <th>ScanCount</th>
      <th>DepartmentDescription</th>
      <th>FinelineNumber</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3</th>
      <td>26</td>
      <td>8</td>
      <td>Friday</td>
      <td>2238403510</td>
      <td>2</td>
      <td>PAINT AND ACCESSORIES</td>
      <td>3565</td>
    </tr>
    <tr>
      <th>4</th>
      <td>26</td>
      <td>8</td>
      <td>Friday</td>
      <td>2006613744</td>
      <td>2</td>
      <td>PAINT AND ACCESSORIES</td>
      <td>1017</td>
    </tr>
  </tbody>
</table>
</div>

<h3 id="quick-review">Quick Review</h3>

<p>I mentioned in the previous lecture we can use all our base and NumPy methods on
pandas DataFrames: Here is a quick review taken from the SQL lesson:</p>

<p><strong>In [8]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">tips</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'https://raw.github.com/pydata/pandas/master/pandas/tests/data/tips.csv'</span><span class="p">)</span>
<span class="n">tips</span><span class="o">.</span><span class="n">head</span><span class="p">()</span></code></pre></figure>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>total_bill</th>
      <th>tip</th>
      <th>sex</th>
      <th>smoker</th>
      <th>day</th>
      <th>time</th>
      <th>size</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>16.99</td>
      <td>1.01</td>
      <td>Female</td>
      <td>No</td>
      <td>Sun</td>
      <td>Dinner</td>
      <td>2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10.34</td>
      <td>1.66</td>
      <td>Male</td>
      <td>No</td>
      <td>Sun</td>
      <td>Dinner</td>
      <td>3</td>
    </tr>
    <tr>
      <th>2</th>
      <td>21.01</td>
      <td>3.50</td>
      <td>Male</td>
      <td>No</td>
      <td>Sun</td>
      <td>Dinner</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>23.68</td>
      <td>3.31</td>
      <td>Male</td>
      <td>No</td>
      <td>Sun</td>
      <td>Dinner</td>
      <td>2</td>
    </tr>
    <tr>
      <th>4</th>
      <td>24.59</td>
      <td>3.61</td>
      <td>Female</td>
      <td>No</td>
      <td>Sun</td>
      <td>Dinner</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div>

<p>SQL select:
<code class="highlighter-rouge">
SELECT total_bill, tip, smoker, time
FROM tips
LIMIT 5;
</code></p>

<p><strong>In [9]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">tips</span><span class="p">[[</span><span class="s">'total_bill'</span><span class="p">,</span> <span class="s">'tip'</span><span class="p">,</span> <span class="s">'smoker'</span><span class="p">,</span> <span class="s">'time'</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span></code></pre></figure>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>total_bill</th>
      <th>tip</th>
      <th>smoker</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>16.99</td>
      <td>1.01</td>
      <td>No</td>
      <td>Dinner</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10.34</td>
      <td>1.66</td>
      <td>No</td>
      <td>Dinner</td>
    </tr>
    <tr>
      <th>2</th>
      <td>21.01</td>
      <td>3.50</td>
      <td>No</td>
      <td>Dinner</td>
    </tr>
    <tr>
      <th>3</th>
      <td>23.68</td>
      <td>3.31</td>
      <td>No</td>
      <td>Dinner</td>
    </tr>
    <tr>
      <th>4</th>
      <td>24.59</td>
      <td>3.61</td>
      <td>No</td>
      <td>Dinner</td>
    </tr>
  </tbody>
</table>
</div>

<p>SQL where:
<code class="highlighter-rouge">
SELECT *
FROM tips
WHERE time = 'Dinner' AND tip &gt; 5.00;
LIMIT 5;
</code></p>

<p><strong>In [11]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">tips</span><span class="p">[(</span><span class="n">tips</span><span class="p">[</span><span class="s">'time'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'Dinner'</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">tips</span><span class="p">[</span><span class="s">'tip'</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">5.00</span><span class="p">)]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span></code></pre></figure>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>total_bill</th>
      <th>tip</th>
      <th>sex</th>
      <th>smoker</th>
      <th>day</th>
      <th>time</th>
      <th>size</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>23</th>
      <td>39.42</td>
      <td>7.58</td>
      <td>Male</td>
      <td>No</td>
      <td>Sat</td>
      <td>Dinner</td>
      <td>4</td>
    </tr>
    <tr>
      <th>44</th>
      <td>30.40</td>
      <td>5.60</td>
      <td>Male</td>
      <td>No</td>
      <td>Sun</td>
      <td>Dinner</td>
      <td>4</td>
    </tr>
    <tr>
      <th>47</th>
      <td>32.40</td>
      <td>6.00</td>
      <td>Male</td>
      <td>No</td>
      <td>Sun</td>
      <td>Dinner</td>
      <td>4</td>
    </tr>
    <tr>
      <th>52</th>
      <td>34.81</td>
      <td>5.20</td>
      <td>Female</td>
      <td>No</td>
      <td>Sun</td>
      <td>Dinner</td>
      <td>4</td>
    </tr>
    <tr>
      <th>59</th>
      <td>48.27</td>
      <td>6.73</td>
      <td>Male</td>
      <td>No</td>
      <td>Sat</td>
      <td>Dinner</td>
      <td>4</td>
    </tr>
  </tbody>
</table>
</div>

<h3 id="groupby">Groupby</h3>

<p>Grouping and summarising data allows us to carry out the key data analysis steps
of <a href="https://www.jstatsoft.org/article/view/v040i01/v40i01.pdf">split, apply,
combine</a>. The journal
article by Hadley Wickham was one of the first formalisations of the split apply
combine paradigm, and we can of course do it in Python.</p>

<ul>
  <li>Splitting the data into groups based on some criteria</li>
  <li>Applying a function to each group independently</li>
  <li>Combining the results into a data structure</li>
</ul>

<p>Let’s continue on with our analysis of the tips data:</p>

<p><strong>In [12]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">tipsgroups</span> <span class="o">=</span> <span class="n">tips</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s">'sex'</span><span class="p">)</span>
<span class="n">tipsgroups</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>&lt;pandas.core.groupby.DataFrameGroupBy object at 0x7f5f60520128&gt;
</code></pre>
</div>

<p>We now have a new data type, the groupby object.
We can access the attribute, groups. This is a dict, with each level as it’s own
entry and the indices of the original data frame:</p>

<p><strong>In [13]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">j</span> <span class="ow">in</span> <span class="n">tipsgroups</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>Female
Male
</code></pre>
</div>

<p>We can do grouping on any axis, or with a custom function (this example is
pathological):</p>

<p><strong>In [14]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">def</span> <span class="nf">myfun</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>

<span class="n">group2</span> <span class="o">=</span> <span class="n">tips</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">myfun</span><span class="p">,</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">group2</span><span class="o">.</span><span class="n">groups</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="p">{</span><span class="err">0:</span><span class="w"> </span><span class="err">['tip',</span><span class="w"> </span><span class="err">'sex',</span><span class="w"> </span><span class="err">'day',</span><span class="w"> </span><span class="err">'time',</span><span class="w"> </span><span class="err">'size'],</span><span class="w"> </span><span class="err">1:</span><span class="w"> </span><span class="err">['total_bill',</span><span class="w"> </span><span class="err">'smoker']</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>We can use tab completion to see all out methods and attributes:</p>

<p><strong>In [43]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="o">%</span><span class="n">matplotlib</span> <span class="n">inline</span>
<span class="n">tipsgroups</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="c">#tipsgroups.boxplot();</span></code></pre></figure>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>total_bill</th>
      <th>tip</th>
      <th>size</th>
    </tr>
    <tr>
      <th>sex</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Female</th>
      <td>18.056897</td>
      <td>2.833448</td>
      <td>2.459770</td>
    </tr>
    <tr>
      <th>Male</th>
      <td>20.744076</td>
      <td>3.089618</td>
      <td>2.630573</td>
    </tr>
  </tbody>
</table>
</div>

<p>We can iterate through groups:</p>

<p><strong>In [36]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">tipsgroups</span><span class="p">:</span>
    <span class="k">print</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>Female
    total_bill   tip     sex smoker  day    time  size
0        16.99  1.01  Female     No  Sun  Dinner     2
4        24.59  3.61  Female     No  Sun  Dinner     4
11       35.26  5.00  Female     No  Sun  Dinner     4
14       14.83  3.02  Female     No  Sun  Dinner     2
16       10.33  1.67  Female     No  Sun  Dinner     3
Male
   total_bill   tip   sex smoker  day    time  size
1       10.34  1.66  Male     No  Sun  Dinner     3
2       21.01  3.50  Male     No  Sun  Dinner     3
3       23.68  3.31  Male     No  Sun  Dinner     2
5       25.29  4.71  Male     No  Sun  Dinner     4
6        8.77  2.00  Male     No  Sun  Dinner     2
</code></pre>
</div>

<p>To apply, we can use .aggregate:</p>

<p><strong>In [15]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">tipsgroups</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span>
<span class="c">#selecting columns:</span>
<span class="n">tipsgroups</span><span class="p">[</span><span class="s">'tip'</span><span class="p">]</span><span class="o">.</span><span class="n">aggregate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">)</span></code></pre></figure>

<div class="highlighter-rouge"><pre class="highlight"><code>sex
Female    2.833448
Male      3.089618
Name: tip, dtype: float64
</code></pre>
</div>

<p><strong>In [16]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#.agg is short for agg</span>
<span class="n">tipsgroups</span><span class="o">.</span><span class="n">agg</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="nb">sum</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">])</span></code></pre></figure>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="3" halign="left">total_bill</th>
      <th colspan="3" halign="left">tip</th>
      <th colspan="3" halign="left">size</th>
    </tr>
    <tr>
      <th></th>
      <th>mean</th>
      <th>sum</th>
      <th>std</th>
      <th>mean</th>
      <th>sum</th>
      <th>std</th>
      <th>mean</th>
      <th>sum</th>
      <th>std</th>
    </tr>
    <tr>
      <th>sex</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Female</th>
      <td>18.056897</td>
      <td>1570.95</td>
      <td>8.009209</td>
      <td>2.833448</td>
      <td>246.51</td>
      <td>1.159495</td>
      <td>2.459770</td>
      <td>214</td>
      <td>0.937644</td>
    </tr>
    <tr>
      <th>Male</th>
      <td>20.744076</td>
      <td>3256.82</td>
      <td>9.246469</td>
      <td>3.089618</td>
      <td>485.07</td>
      <td>1.489102</td>
      <td>2.630573</td>
      <td>413</td>
      <td>0.955997</td>
    </tr>
  </tbody>
</table>
</div>

<p><strong>In [17]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#we can also use a dict, to do different things to different rows:</span>
<span class="n">tipsgroups</span><span class="o">.</span><span class="n">agg</span><span class="p">({</span><span class="s">'tip'</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="nb">sum</span><span class="p">],</span> <span class="s">'size'</span><span class="p">:</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">)})</span></code></pre></figure>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">tip</th>
      <th>size</th>
    </tr>
    <tr>
      <th></th>
      <th>mean</th>
      <th>sum</th>
      <th>&lt;lambda&gt;</th>
    </tr>
    <tr>
      <th>sex</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Female</th>
      <td>2.833448</td>
      <td>246.51</td>
      <td>6</td>
    </tr>
    <tr>
      <th>Male</th>
      <td>3.089618</td>
      <td>485.07</td>
      <td>6</td>
    </tr>
  </tbody>
</table>
</div>

<p>We can also filter, transform, plot, count etc etc. Take a look in the help for
more details!</p>

<h3 id="joins">Joins</h3>

<p>We can use a variety of joins in pandas, the most basic using the concat
function:</p>

<p><strong>In [18]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df1</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">({</span><span class="s">'A'</span><span class="p">:</span> <span class="p">[</span><span class="s">'A0'</span><span class="p">,</span> <span class="s">'A1'</span><span class="p">,</span> <span class="s">'A2'</span><span class="p">,</span> <span class="s">'A3'</span><span class="p">],</span>
                    <span class="s">'B'</span><span class="p">:</span> <span class="p">[</span><span class="s">'B0'</span><span class="p">,</span> <span class="s">'B1'</span><span class="p">,</span> <span class="s">'B2'</span><span class="p">,</span> <span class="s">'B3'</span><span class="p">],</span>
                    <span class="s">'C'</span><span class="p">:</span> <span class="p">[</span><span class="s">'C0'</span><span class="p">,</span> <span class="s">'C1'</span><span class="p">,</span> <span class="s">'C2'</span><span class="p">,</span> <span class="s">'C3'</span><span class="p">],</span>
                    <span class="s">'D'</span><span class="p">:</span> <span class="p">[</span><span class="s">'D0'</span><span class="p">,</span> <span class="s">'D1'</span><span class="p">,</span> <span class="s">'D2'</span><span class="p">,</span> <span class="s">'D3'</span><span class="p">]},</span>
                     <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">({</span><span class="s">'A'</span><span class="p">:</span> <span class="p">[</span><span class="s">'A4'</span><span class="p">,</span> <span class="s">'A5'</span><span class="p">,</span> <span class="s">'A6'</span><span class="p">,</span> <span class="s">'A7'</span><span class="p">],</span>
                    <span class="s">'B'</span><span class="p">:</span> <span class="p">[</span><span class="s">'B4'</span><span class="p">,</span> <span class="s">'B5'</span><span class="p">,</span> <span class="s">'B6'</span><span class="p">,</span> <span class="s">'B7'</span><span class="p">],</span>
                    <span class="s">'C'</span><span class="p">:</span> <span class="p">[</span><span class="s">'C4'</span><span class="p">,</span> <span class="s">'C5'</span><span class="p">,</span> <span class="s">'C6'</span><span class="p">,</span> <span class="s">'C7'</span><span class="p">],</span>
                    <span class="s">'D'</span><span class="p">:</span> <span class="p">[</span><span class="s">'D4'</span><span class="p">,</span> <span class="s">'D5'</span><span class="p">,</span> <span class="s">'D6'</span><span class="p">,</span> <span class="s">'D7'</span><span class="p">]},</span>
                     <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">])</span></code></pre></figure>

<p><strong>In [19]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#joins on index</span>
<span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">])</span></code></pre></figure>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A0</td>
      <td>B0</td>
      <td>C0</td>
      <td>D0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>A1</td>
      <td>B1</td>
      <td>C1</td>
      <td>D1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>A2</td>
      <td>B2</td>
      <td>C2</td>
      <td>D2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>A3</td>
      <td>B3</td>
      <td>C3</td>
      <td>D3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>A4</td>
      <td>B4</td>
      <td>C4</td>
      <td>D4</td>
    </tr>
    <tr>
      <th>5</th>
      <td>A5</td>
      <td>B5</td>
      <td>C5</td>
      <td>D5</td>
    </tr>
    <tr>
      <th>6</th>
      <td>A6</td>
      <td>B6</td>
      <td>C6</td>
      <td>D6</td>
    </tr>
    <tr>
      <th>7</th>
      <td>A7</td>
      <td>B7</td>
      <td>C7</td>
      <td>D7</td>
    </tr>
  </tbody>
</table>
</div>

<p><strong>In [20]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#joins on index!</span>
<span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span></code></pre></figure>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A0</td>
      <td>B0</td>
      <td>C0</td>
      <td>D0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>A1</td>
      <td>B1</td>
      <td>C1</td>
      <td>D1</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>A2</td>
      <td>B2</td>
      <td>C2</td>
      <td>D2</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>A3</td>
      <td>B3</td>
      <td>C3</td>
      <td>D3</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>A4</td>
      <td>B4</td>
      <td>C4</td>
      <td>D4</td>
    </tr>
    <tr>
      <th>5</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>A5</td>
      <td>B5</td>
      <td>C5</td>
      <td>D5</td>
    </tr>
    <tr>
      <th>6</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>A6</td>
      <td>B6</td>
      <td>C6</td>
      <td>D6</td>
    </tr>
    <tr>
      <th>7</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>A7</td>
      <td>B7</td>
      <td>C7</td>
      <td>D7</td>
    </tr>
  </tbody>
</table>
</div>

<p><strong>In [21]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c">#we can ignore the index!</span>
<span class="n">df1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span></code></pre></figure>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>A</th>
      <th>B</th>
      <th>C</th>
      <th>D</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A0</td>
      <td>B0</td>
      <td>C0</td>
      <td>D0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>A1</td>
      <td>B1</td>
      <td>C1</td>
      <td>D1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>A2</td>
      <td>B2</td>
      <td>C2</td>
      <td>D2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>A3</td>
      <td>B3</td>
      <td>C3</td>
      <td>D3</td>
    </tr>
    <tr>
      <th>4</th>
      <td>A4</td>
      <td>B4</td>
      <td>C4</td>
      <td>D4</td>
    </tr>
    <tr>
      <th>5</th>
      <td>A5</td>
      <td>B5</td>
      <td>C5</td>
      <td>D5</td>
    </tr>
    <tr>
      <th>6</th>
      <td>A6</td>
      <td>B6</td>
      <td>C6</td>
      <td>D6</td>
    </tr>
    <tr>
      <th>7</th>
      <td>A7</td>
      <td>B7</td>
      <td>C7</td>
      <td>D7</td>
    </tr>
  </tbody>
</table>
</div>

<p>For more control, we might want to explicitly use merge!</p>

<p>We have the standard joins - inner, outer, left, right, full and union:</p>

<p><strong>In [78]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">df1</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">({</span><span class="s">'key'</span><span class="p">:</span> <span class="p">[</span><span class="s">'A'</span><span class="p">,</span> <span class="s">'B'</span><span class="p">,</span> <span class="s">'C'</span><span class="p">,</span> <span class="s">'D'</span><span class="p">],</span>
                 <span class="s">'value'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">4</span><span class="p">)})</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s">'key'</span><span class="p">:</span> <span class="p">[</span><span class="s">'B'</span><span class="p">,</span> <span class="s">'D'</span><span class="p">,</span> <span class="s">'D'</span><span class="p">,</span> <span class="s">'E'</span><span class="p">],</span>
                    <span class="s">'value'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">4</span><span class="p">)})</span>
<span class="c">#SQL:</span>
<span class="c">#SELECT *</span>
<span class="c">#FROM df1</span>
<span class="c">#INNER JOIN df2</span>
<span class="c">#  ON df1.key = df2.key;</span>
<span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s">'key'</span><span class="p">)</span>
<span class="c">#SQL:</span>
<span class="c">#SELECT *</span>
<span class="c">#FROM df1</span>
<span class="c">#LEFT OUTER JOIN df2</span>
<span class="c">#  ON df1.key = df2.key;</span>
<span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s">'key'</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s">'left'</span><span class="p">)</span>
<span class="c">#SQL:</span>
<span class="c">#SELECT *</span>
<span class="c">#FROM df1</span>
<span class="c">#RIGHT OUTER JOIN df2</span>
<span class="c">#  ON df1.key = df2.key;</span>
<span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s">'key'</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s">'right'</span><span class="p">)</span>
<span class="c">#SQL:</span>
<span class="c">#SELECT *</span>
<span class="c">#FROM df1</span>
<span class="c">#FULL OUTER JOIN df2</span>
<span class="c">#  ON df1.key = df2.key;</span>
<span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="n">df2</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s">'key'</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s">'outer'</span><span class="p">)</span></code></pre></figure>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>key</th>
      <th>value_x</th>
      <th>value_y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>A</td>
      <td>-2.275516</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>B</td>
      <td>0.050553</td>
      <td>2.301355</td>
    </tr>
    <tr>
      <th>2</th>
      <td>C</td>
      <td>0.943035</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>D</td>
      <td>-0.237517</td>
      <td>0.449717</td>
    </tr>
    <tr>
      <th>4</th>
      <td>D</td>
      <td>-0.237517</td>
      <td>-1.692712</td>
    </tr>
    <tr>
      <th>5</th>
      <td>E</td>
      <td>NaN</td>
      <td>-1.079463</td>
    </tr>
  </tbody>
</table>
</div>

<p>We have not covered a bunch of stuff: <a href="http://pandas.pydata.org/pandas-docs/stable/reshaping.html">Pivot tables and
reshaping</a>, <a href="http://pandas.pydata.org/pandas-
docs/version/0.18.0/whatsnew.html#whatsnew-0180-enhancements-moments">window
functions (which were completely updated on
Sunday)</a> and <a href="http://pandas.pydata.org/pandas-docs/stable/timeseries.html">time
series</a>. We will
cover these as we continue throughout the course.</p>

<h3 id="example">Example</h3>

<p>From here, we will look at a worked example of data analysis using pandas. In
the first lesson, we looked at the example of the tennis fixing scandal, and
briefly ran through it. Now we have the skills and knowledge to walk through it,
and assess the analysis.</p>

<p>Here’s the link to the <a href="http://www.buzzfeed.com/heidiblake/the-tennis-racket">original
article</a> and the <a href="https://github.com/BuzzFeedNews/2016-01-tennis-betting-analysis">notebook
on github</a></p>

<h3 id="exercises">Exercises</h3>

<ul>
  <li>
    <p>Update pandas, using conda. Read the documentation for the new window
functions.</p>
  </li>
  <li>
    <p>Read through the tennis example, and make sure you understand the basic idea
of what is being done</p>
  </li>
  <li>
    <p>Rewrite cell 5, so that it does not use the ~ for negation - you might need to
google how to do this</p>
  </li>
  <li>
    <p>Write a function or statement to find how many of the report_players are in
your list of significant outliers (the output of cell 21)</p>
  </li>
  <li>
    <p>Read the following csv in, using io.StringIO. There is no header!</p>
  </li>
</ul>

<p><strong>In [1]:</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">data</span> <span class="o">=</span> <span class="s">"""</span><span class="se">\
</span><span class="s">10/08/2012,12:10:10,name1,0.81,4.02,50;18.5701400N,4;07.7693770E,7.92,10.50,0.0106,4.30,0.0301
10/08/2012,12:10:11,name2,-999,-999,-999,-999,10.87,1.40,0.0099,9.70,0.0686
"""</span></code></pre></figure>

<ul>
  <li>
    <p>Read in the data as above, but with -999 being a missing value</p>
  </li>
  <li>
    <p>(advanced) From the tennis data frame, find the player (by hash) who has the
worst winning record. Find the player with the best winning record (remember, we
have a row for each betting agent on each match!)</p>
  </li>
</ul>

  </div>
  
      <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'jeremycg';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>

  
</article>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">Python @ Precima</h2>



  </div>

</footer>


  </body>

</html>
